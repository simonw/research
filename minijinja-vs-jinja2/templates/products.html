{% extends "base.html" %}

{% block title %}{{ category }} Products - {{ site_name }}{% endblock %}

{% block extra_styles %}
.product-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}
.product-card {
    border: 1px solid #ddd;
    padding: 15px;
    border-radius: 8px;
    background: white;
}
.product-card h3 {
    margin-top: 0;
    color: #333;
}
.price {
    font-size: 1.2em;
    font-weight: bold;
    color: #007bff;
}
.badge {
    display: inline-block;
    padding: 3px 8px;
    border-radius: 3px;
    font-size: 0.8em;
    margin-right: 5px;
}
.badge-sale { background: #ff4444; color: white; }
.badge-new { background: #44ff44; color: black; }
.badge-featured { background: #ffaa00; color: black; }
{% endblock %}

{% block content %}
<h2>{{ category }} Products</h2>

{% if filters %}
<div class="filters">
    <h3>Active Filters:</h3>
    <ul>
    {% for filter_name, filter_value in filters.items() %}
        <li><strong>{{ filter_name }}:</strong> {{ filter_value }}</li>
    {% endfor %}
    </ul>
</div>
{% endif %}

<div class="stats">
    <p>Showing {{ products|length }} products</p>
    {% if products %}
    <p>Showing products in various price ranges</p>
    {% endif %}
</div>

<div class="product-grid">
    {% for product in products %}
    <div class="product-card">
        <h3>{{ product.name }}</h3>
        <p>{{ product.description[:100] }}{% if product.description|length > 100 %}...{% endif %}</p>

        <div class="badges">
            {% if product.on_sale %}
            <span class="badge badge-sale">SALE</span>
            {% endif %}
            {% if product.is_new %}
            <span class="badge badge-new">NEW</span>
            {% endif %}
            {% if product.featured %}
            <span class="badge badge-featured">FEATURED</span>
            {% endif %}
        </div>

        <div class="price">
            {% if product.on_sale %}
            <s>${{ product.original_price }}</s>
            ${{ product.price }}
            <span class="discount">({{ ((product.original_price - product.price) / product.original_price * 100)|int }}% off)</span>
            {% else %}
            ${{ product.price }}
            {% endif %}
        </div>

        <div class="metadata">
            <p><strong>SKU:</strong> {{ product.sku }}</p>
            <p><strong>Stock:</strong> {{ product.stock }} units</p>
            <p><strong>Rating:</strong> {{ "★" * product.rating }}{{ "☆" * (5 - product.rating) }} ({{ product.reviews }} reviews)</p>
        </div>

        {% if product.tags %}
        <div class="tags">
            {% for tag in product.tags %}
            <span class="tag">{{ tag }}</span>
            {% if not loop.last %}, {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <div class="category-path">
            {% for cat in product.category_path %}
            {{ cat }}{% if not loop.last %} &gt; {% endif %}
            {% endfor %}
        </div>
    </div>
    {% else %}
    <p>No products found in this category.</p>
    {% endfor %}
</div>

{% if products|length > 10 %}
<div class="summary">
    <h3>Product Summary</h3>
    <ul>
        <li>Total products: {{ products|length }}</li>
        {% set on_sale_count = 0 %}
        {% set new_count = 0 %}
        {% set featured_count = 0 %}
        {% set rating_sum = 0 %}
        {% for p in products %}
            {% if p.on_sale %}{% set on_sale_count = on_sale_count + 1 %}{% endif %}
            {% if p.is_new %}{% set new_count = new_count + 1 %}{% endif %}
            {% if p.featured %}{% set featured_count = featured_count + 1 %}{% endif %}
            {% set rating_sum = rating_sum + p.rating %}
        {% endfor %}
        <li>On sale: {{ on_sale_count }}</li>
        <li>New products: {{ new_count }}</li>
        <li>Featured products: {{ featured_count }}</li>
        <li>Total rating points: {{ rating_sum }}</li>
    </ul>
</div>
{% endif %}

{% endblock %}
