UV RUN EXECUTION FLOW DIAGRAM
================================

┌─────────────────────────────────────────────────────────────────┐
│ USER COMMAND: uv run myscript.py                                │
└────────────────────────┬────────────────────────────────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   1. INITIALIZATION           │
         │   - Check recursion depth     │
         │   - Validate requirements     │
         │   - Load .env files           │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   2. PROJECT DISCOVERY        │
         │   - Search for pyproject.toml │
         │   - Walk up directory tree    │
         │   - Find workspace root       │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   3. PARSE PYPROJECT.TOML     │
         │   - Read TOML content         │
         │   - Parse [project] table     │
         │   - Parse [tool.uv] table     │
         │   - Extract dependencies      │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   4. PYTHON DISCOVERY         │
         │   - Check --python flag       │
         │   - Check requires-python     │
         │   - Check .python-version     │
         │   - Search system PATH        │
         │   - Download if needed        │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   5. VIRTUAL ENVIRONMENT      │
         │   - Check for .venv/          │
         │   - Create if missing         │
         │   - Validate pyvenv.cfg       │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   6. DEPENDENCY LOCKING       │
         │                               │
         │   ┌───────────────────────┐   │
         │   │ Check uv.lock exists  │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Collect Requirements  │   │
         │   │ - project.deps        │   │
         │   │ - extras              │   │
         │   │ - groups              │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ PubGrub Resolution    │   │
         │   │ - Query indexes       │   │
         │   │ - Resolve versions    │   │
         │   │ - Handle conflicts    │   │
         │   │ - Apply markers       │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Write uv.lock         │   │
         │   │ - Package list        │   │
         │   │ - Versions & sources  │   │
         │   │ - Hashes              │   │
         │   └───────────────────────┘   │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   7. ENVIRONMENT SYNC         │
         │                               │
         │   ┌───────────────────────┐   │
         │   │ Scan site-packages    │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Compare with lock     │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Download packages     │   │
         │   │ - Wheels from PyPI    │   │
         │   │ - Parallel downloads  │   │
         │   │ - Verify hashes       │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Build if needed       │   │
         │   │ - Setup build env     │   │
         │   │ - Install build deps  │   │
         │   │ - Run build backend   │   │
         │   └───────┬───────────────┘   │
         │           │                   │
         │           ▼                   │
         │   ┌───────────────────────┐   │
         │   │ Install wheels        │   │
         │   │ - Extract to site-pkg │   │
         │   │ - Create entry points │   │
         │   │ - Write metadata      │   │
         │   └───────────────────────┘   │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   8. COMMAND EXECUTION        │
         │   - Detect command type       │
         │   - Setup PATH env var        │
         │   - Set VIRTUAL_ENV           │
         │   - Spawn process             │
         │   - Wait for completion       │
         └───────────────┬───────────────┘
                         │
                         ▼
         ┌───────────────────────────────┐
         │   myscript.py EXECUTES        │
         │   with all dependencies!      │
         └───────────────────────────────┘


KEY CRATES AND RESPONSIBILITIES
================================

┌──────────────────┬──────────────────────────────────────────┐
│ Crate            │ Responsibility                           │
├──────────────────┼──────────────────────────────────────────┤
│ uv               │ Main CLI, command orchestration          │
│ uv-cli           │ Command-line argument parsing            │
│ uv-workspace     │ pyproject.toml parsing, project discovery│
│ uv-resolver      │ PubGrub dependency resolution            │
│ uv-client        │ HTTP client, package index queries       │
│ uv-installer     │ Package installation, site-packages mgmt │
│ uv-install-wheel │ Wheel extraction and installation        │
│ uv-build-frontend│ PEP 517 build frontend                   │
│ uv-python        │ Python interpreter discovery/download    │
│ uv-virtualenv    │ Virtual environment creation             │
│ uv-cache         │ Download and build caching               │
│ uv-pep440        │ Python version parsing                   │
│ uv-pep508        │ Dependency specification parsing         │
└──────────────────┴──────────────────────────────────────────┘


DECISION POINTS
===============

Lock Mode Selection:
  ┌─ frozen? ──> Use existing uv.lock without validation
  │
  ├─ locked? ──> Validate uv.lock is current, error if not
  │
  └─ default ──> Create/update uv.lock

Python Selection Priority:
  1. --python CLI flag
  2. requires-python in pyproject.toml
  3. .python-version file
  4. System Python in PATH

Package Source Selection:
  ┌─ Wheel available? ──> Download and install wheel
  │
  └─ Source dist only ──> Download, build wheel, install

Environment Strategy:
  ┌─ --isolated? ──> Create ephemeral temp venv
  │
  ├─ .venv exists? ──> Use existing .venv
  │
  └─ default ──> Create .venv in workspace root
